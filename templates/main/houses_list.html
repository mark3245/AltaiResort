{% extends 'base.html' %}
{% load static %}

{% block title %}–î–æ–º–∞ –¥–ª—è –æ—Ç–¥—ã—Ö–∞ - AltaiResort{% endblock %}

{% block content %}
<section class="houses-list-page py-5">
    <div class="container">
        <!-- Page header -->
        <div class="text-center mb-5">
            <h1 class="section-title">–ù–∞—à–∏ –¥–æ–º–∞</h1>
            <p class="lead">–í—ã–±–µ—Ä–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–æ–º –¥–ª—è –≤–∞—à–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –≤ –≥–æ—Ä–∞—Ö –ê–ª—Ç–∞—è</p>
        </div>

        <!-- Filters and search -->
        <div class="filters-section mb-5">
            <div class="card">
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-3">
                            <label for="search" class="form-label">–ü–æ–∏—Å–∫</label>
                            <input type="text" class="form-control" id="search" name="search" 
                                   value="{{ request.GET.search }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–º–∞...">
                        </div>
                        <div class="col-md-2">
                            <label for="min_price" class="form-label">–¶–µ–Ω–∞ –æ—Ç</label>
                            <input type="number" class="form-control" id="min_price" name="min_price" 
                                   value="{{ request.GET.min_price }}" placeholder="‚ÇΩ">
                        </div>
                        <div class="col-md-2">
                            <label for="max_price" class="form-label">–¶–µ–Ω–∞ –¥–æ</label>
                            <input type="number" class="form-control" id="max_price" name="max_price" 
                                   value="{{ request.GET.max_price }}" placeholder="‚ÇΩ">
                        </div>
                        <div class="col-md-2">
                            <label for="capacity" class="form-label">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</label>
                            <select class="form-control" id="capacity" name="capacity">
                                <option value="">–õ—é–±–∞—è</option>
                                <option value="1" {% if request.GET.capacity == "1" %}selected{% endif %}>1 —á–µ–ª–æ–≤–µ–∫</option>
                                <option value="2" {% if request.GET.capacity == "2" %}selected{% endif %}>2 —á–µ–ª–æ–≤–µ–∫–∞</option>
                                <option value="3" {% if request.GET.capacity == "3" %}selected{% endif %}>3 —á–µ–ª–æ–≤–µ–∫–∞</option>
                                <option value="4" {% if request.GET.capacity == "4" %}selected{% endif %}>4 —á–µ–ª–æ–≤–µ–∫–∞</option>
                                <option value="5" {% if request.GET.capacity == "5" %}selected{% endif %}>5 —á–µ–ª–æ–≤–µ–∫</option>
                                <option value="6" {% if request.GET.capacity == "6" %}selected{% endif %}>6 —á–µ–ª–æ–≤–µ–∫</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="sort" class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                            <select class="form-control" id="sort" name="sort">
                                <option value="name" {% if request.GET.sort == "name" %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                                <option value="price_low" {% if request.GET.sort == "price_low" %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)</option>
                                <option value="price_high" {% if request.GET.sort == "price_high" %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ (—É–±—ã–≤–∞–Ω–∏–µ)</option>
                                <option value="capacity" {% if request.GET.sort == "capacity" %}selected{% endif %}>–ü–æ –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏</option>
                            </select>
                        </div>
                        <div class="col-12 text-center">
                            <button type="submit" class="btn btn-primary me-2">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                            <a href="{% url 'main:houses_list' %}" class="btn btn-outline-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Results count -->
        {% if houses %}
        <div class="results-info mb-4">
            <p class="text-muted">–ù–∞–π–¥–µ–Ω–æ –¥–æ–º–æ–≤: {{ houses|length }}</p>
        </div>
        {% endif %}

        <!-- Houses grid -->
        {% if houses %}
        <div class="row">
            {% for house in houses %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card house-card h-100">
                    {% if house.image %}
                    <img src="{{ house.image.url }}" class="card-img-top" alt="{{ house.name }}" loading="lazy">
                    {% else %}
                    <div class="card-img-top no-image">
                        <div class="no-image-placeholder">
                            <span>üè†</span>
                            <p>–§–æ—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="card-body d-flex flex-column">
                        <h3 class="card-title">{{ house.name }}</h3>
                        <p class="card-text flex-grow-1">{{ house.description|truncatewords:25 }}</p>
                        
                        <div class="house-features mb-3">
                            <span class="badge bg-primary">üë• {{ house.capacity }} –º–µ—Å—Ç</span>
                            <span class="badge bg-success">üí∞ {{ house.price_per_night }} ‚ÇΩ/–Ω–æ—á—å</span>
                        </div>
                        
                        <div class="house-amenities mb-3">
                            <small class="text-muted">
                                <span class="me-3">üõèÔ∏è {{ house.capacity }} —Å–ø–∞–ª—å–Ω—ã—Ö –º–µ—Å—Ç</span>
                                <span>üöø –î—É—à</span>
                            </small>
                        </div>
                    </div>
                    
                    <div class="card-footer">
                        <div class="d-grid gap-2">
                            <a href="{% url 'main:house_detail' house.id %}" class="btn btn-outline-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            <a href="{% url 'main:booking' %}?house={{ house.id }}" class="btn btn-primary">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-5">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                    </a>
                </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <li class="page-item active">
                        <span class="page-link">{{ num }}</span>
                    </li>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            {{ num }}
                        </a>
                    </li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        –°–ª–µ–¥—É—é—â–∞—è
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        {% else %}
        <!-- No results -->
        <div class="text-center py-5">
            <div class="no-results">
                <h3>üòî –î–æ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p class="lead">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω–∞–º</p>
                <a href="{% url 'main:houses_list' %}" class="btn btn-primary me-2">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ–º–∞</a>
                <a href="{% url 'main:contact' %}" class="btn btn-outline-primary">–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏</a>
            </div>
        </div>
        {% endif %}

        <!-- CTA section -->
        <div class="cta-section text-center mt-5">
            <div class="card bg-primary text-white">
                <div class="card-body py-5">
                    <h2>–ù–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–æ–º?</h2>
                    <p class="lead">–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏, –∏ –º—ã –ø–æ–º–æ–∂–µ–º –ø–æ–¥–æ–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –æ—Ç–¥—ã—Ö–∞</p>
                    <div class="cta-buttons">
                        <a href="{% url 'main:contact' %}" class="btn btn-light btn-lg me-3">–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º</a>
                        <a href="tel:{{ contact.phone|default:'+79991234567' }}" class="btn btn-outline-light btn-lg">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.house-card {
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.house-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.house-card .card-img-top {
    height: 200px;
    object-fit: cover;
}

.no-image {
    height: 200px;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
}

.no-image-placeholder {
    text-align: center;
    color: #6c757d;
}

.no-image-placeholder span {
    font-size: 3rem;
    display: block;
    margin-bottom: 0.5rem;
}

.house-features .badge {
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
}

.house-amenities {
    border-top: 1px solid #e9ecef;
    padding-top: 1rem;
}

.filters-section .card {
    border: 1px solid #e9ecef;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.results-info {
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid var(--primary-color);
}

.no-results {
    padding: 2rem;
}

.no-results h3 {
    color: var(--text-light);
    margin-bottom: 1rem;
}

.cta-section .card {
    border: none;
    border-radius: 12px;
}

.pagination .page-link {
    color: var(--primary-color);
    border-color: var(--border-color);
}

.pagination .page-item.active .page-link {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

@media (max-width: 768px) {
    .filters-section .col-md-3,
    .filters-section .col-md-2 {
        margin-bottom: 1rem;
    }
    
    .house-card .card-img-top {
        height: 180px;
    }
}
</style>
{% endblock %}

